var cov_1kd2f9lwom=function(){var path="/home/adrianzhu/Avarus-App/avarus-api/logic/user/edit-user/index.spec.js";var hash="5849042922164f7fd572fbd7d35976fe9019bffd";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/adrianzhu/Avarus-App/avarus-api/logic/user/edit-user/index.spec.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:26}},"1":{start:{line:2,column:33},end:{line:2,column:40}},"2":{start:{line:3,column:19},end:{line:3,column:34}},"3":{start:{line:4,column:19},end:{line:4,column:23}},"4":{start:{line:5,column:17},end:{line:5,column:29}},"5":{start:{line:6,column:85},end:{line:6,column:107}},"6":{start:{line:7,column:39},end:{line:7,column:61}},"7":{start:{line:8,column:15},end:{line:8,column:34}},"8":{start:{line:10,column:0},end:{line:143,column:2}},"9":{start:{line:11,column:2},end:{line:11,column:45}},"10":{start:{line:11,column:15},end:{line:11,column:44}},"11":{start:{line:15,column:2},end:{line:141,column:4}},"12":{start:{line:16,column:4},end:{line:29,column:6}},"13":{start:{line:17,column:6},end:{line:17,column:29}},"14":{start:{line:19,column:6},end:{line:19,column:42}},"15":{start:{line:20,column:6},end:{line:20,column:39}},"16":{start:{line:21,column:6},end:{line:21,column:58}},"17":{start:{line:22,column:6},end:{line:22,column:19}},"18":{start:{line:23,column:6},end:{line:23,column:23}},"19":{start:{line:25,column:19},end:{line:25,column:140}},"20":{start:{line:26,column:6},end:{line:26,column:18}},"21":{start:{line:28,column:6},end:{line:28,column:23}},"22":{start:{line:31,column:4},end:{line:47,column:6}},"23":{start:{line:32,column:6},end:{line:32,column:45}},"24":{start:{line:33,column:6},end:{line:33,column:51}},"25":{start:{line:35,column:6},end:{line:35,column:68}},"26":{start:{line:37,column:19},end:{line:37,column:42}},"27":{start:{line:39,column:6},end:{line:39,column:27}},"28":{start:{line:40,column:6},end:{line:40,column:34}},"29":{start:{line:41,column:6},end:{line:41,column:46}},"30":{start:{line:42,column:6},end:{line:42,column:43}},"31":{start:{line:44,column:18},end:{line:44,column:63}},"32":{start:{line:45,column:6},end:{line:45,column:30}},"33":{start:{line:49,column:4},end:{line:65,column:6}},"34":{start:{line:51,column:6},end:{line:51,column:26}},"35":{start:{line:52,column:6},end:{line:52,column:64}},"36":{start:{line:54,column:6},end:{line:54,column:68}},"37":{start:{line:55,column:19},end:{line:55,column:42}},"38":{start:{line:57,column:6},end:{line:57,column:27}},"39":{start:{line:58,column:6},end:{line:58,column:34}},"40":{start:{line:59,column:6},end:{line:59,column:46}},"41":{start:{line:60,column:6},end:{line:60,column:40}},"42":{start:{line:62,column:18},end:{line:62,column:66}},"43":{start:{line:63,column:6},end:{line:63,column:30}},"44":{start:{line:67,column:4},end:{line:88,column:6}},"45":{start:{line:68,column:6},end:{line:68,column:26}},"46":{start:{line:69,column:6},end:{line:69,column:42}},"47":{start:{line:70,column:6},end:{line:70,column:38}},"48":{start:{line:72,column:6},end:{line:87,column:7}},"49":{start:{line:74,column:8},end:{line:74,column:70}},"50":{start:{line:76,column:8},end:{line:76,column:50}},"51":{start:{line:80,column:8},end:{line:80,column:30}},"52":{start:{line:81,column:8},end:{line:81,column:38}},"53":{start:{line:82,column:8},end:{line:82,column:55}},"54":{start:{line:83,column:8},end:{line:83,column:59}},"55":{start:{line:84,column:8},end:{line:84,column:57}},"56":{start:{line:85,column:8},end:{line:85,column:159}},"57":{start:{line:90,column:4},end:{line:111,column:6}},"58":{start:{line:91,column:6},end:{line:91,column:26}},"59":{start:{line:92,column:6},end:{line:92,column:29}},"60":{start:{line:93,column:6},end:{line:93,column:51}},"61":{start:{line:95,column:6},end:{line:110,column:7}},"62":{start:{line:97,column:8},end:{line:97,column:70}},"63":{start:{line:99,column:8},end:{line:99,column:50}},"64":{start:{line:103,column:8},end:{line:103,column:30}},"65":{start:{line:104,column:8},end:{line:104,column:38}},"66":{start:{line:105,column:8},end:{line:105,column:55}},"67":{start:{line:106,column:8},end:{line:106,column:59}},"68":{start:{line:107,column:8},end:{line:107,column:57}},"69":{start:{line:108,column:8},end:{line:108,column:159}},"70":{start:{line:113,column:4},end:{line:125,column:6}},"71":{start:{line:114,column:20},end:{line:114,column:46}},"72":{start:{line:116,column:6},end:{line:124,column:7}},"73":{start:{line:117,column:8},end:{line:117,column:31}},"74":{start:{line:119,column:8},end:{line:119,column:50}},"75":{start:{line:121,column:8},end:{line:121,column:30}},"76":{start:{line:122,column:8},end:{line:122,column:56}},"77":{start:{line:123,column:8},end:{line:123,column:75}},"78":{start:{line:127,column:4},end:{line:139,column:6}},"79":{start:{line:128,column:22},end:{line:128,column:44}},"80":{start:{line:130,column:6},end:{line:138,column:7}},"81":{start:{line:131,column:8},end:{line:131,column:33}},"82":{start:{line:133,column:8},end:{line:133,column:50}},"83":{start:{line:135,column:8},end:{line:135,column:30}},"84":{start:{line:136,column:8},end:{line:136,column:55}},"85":{start:{line:137,column:8},end:{line:137,column:72}},"86":{start:{line:142,column:2},end:{line:142,column:58}},"87":{start:{line:142,column:14},end:{line:142,column:57}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:10,column:30},end:{line:10,column:31}},loc:{start:{line:10,column:36},end:{line:143,column:1}},line:10},"1":{name:"(anonymous_1)",decl:{start:{line:11,column:9},end:{line:11,column:10}},loc:{start:{line:11,column:15},end:{line:11,column:44}},line:11},"2":{name:"(anonymous_2)",decl:{start:{line:15,column:46},end:{line:15,column:47}},loc:{start:{line:15,column:52},end:{line:141,column:3}},line:15},"3":{name:"(anonymous_3)",decl:{start:{line:16,column:15},end:{line:16,column:16}},loc:{start:{line:16,column:27},end:{line:29,column:5}},line:16},"4":{name:"(anonymous_4)",decl:{start:{line:31,column:62},end:{line:31,column:63}},loc:{start:{line:31,column:74},end:{line:47,column:5}},line:31},"5":{name:"(anonymous_5)",decl:{start:{line:49,column:65},end:{line:49,column:66}},loc:{start:{line:49,column:77},end:{line:65,column:5}},line:49},"6":{name:"(anonymous_6)",decl:{start:{line:67,column:69},end:{line:67,column:70}},loc:{start:{line:67,column:81},end:{line:88,column:5}},line:67},"7":{name:"(anonymous_7)",decl:{start:{line:90,column:69},end:{line:90,column:70}},loc:{start:{line:90,column:81},end:{line:111,column:5}},line:90},"8":{name:"(anonymous_8)",decl:{start:{line:113,column:39},end:{line:113,column:40}},loc:{start:{line:113,column:51},end:{line:125,column:5}},line:113},"9":{name:"(anonymous_9)",decl:{start:{line:127,column:54},end:{line:127,column:55}},loc:{start:{line:127,column:66},end:{line:139,column:5}},line:127},"10":{name:"(anonymous_10)",decl:{start:{line:142,column:8},end:{line:142,column:9}},loc:{start:{line:142,column:14},end:{line:142,column:57}},line:142}},branchMap:{},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},b:{},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"5849042922164f7fd572fbd7d35976fe9019bffd"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();cov_1kd2f9lwom.s[0]++;require('dotenv').config();const{env:{TEST_DB_URL}}=(cov_1kd2f9lwom.s[1]++,process);const{expect}=(cov_1kd2f9lwom.s[2]++,require('chai'));const{random}=(cov_1kd2f9lwom.s[3]++,Math);const editUser=(cov_1kd2f9lwom.s[4]++,require('.'));const{errors:{NotFoundError,ContentError,ConflictError,CredentialsError}}=(cov_1kd2f9lwom.s[5]++,require('avarus-util'));const{database,models:{User}}=(cov_1kd2f9lwom.s[6]++,require('avarus-data'));const bcrypt=(cov_1kd2f9lwom.s[7]++,require('bcryptjs'));cov_1kd2f9lwom.s[8]++;describe('logic - edit user',()=>{cov_1kd2f9lwom.f[0]++;cov_1kd2f9lwom.s[9]++;before(()=>{cov_1kd2f9lwom.f[1]++;cov_1kd2f9lwom.s[10]++;return database.connect(TEST_DB_URL);});let email,username,password,verifiedPassword,budget,id,transactions;let newEmail,newPassword,newVerifiedPassword;cov_1kd2f9lwom.s[11]++;describe('when user is registed correctly',()=>{cov_1kd2f9lwom.f[2]++;cov_1kd2f9lwom.s[12]++;beforeEach(async()=>{cov_1kd2f9lwom.f[3]++;cov_1kd2f9lwom.s[13]++;await User.deleteMany();cov_1kd2f9lwom.s[14]++;email=`email-${random()}@mail.com`;cov_1kd2f9lwom.s[15]++;username=`username-${random()}`;cov_1kd2f9lwom.s[16]++;password=verifiedPassword=`password-${random()}`;cov_1kd2f9lwom.s[17]++;budget=5000;cov_1kd2f9lwom.s[18]++;transactions=[];const user=(cov_1kd2f9lwom.s[19]++,await User.create({email,username,password:await bcrypt.hash(password,10),verifiedPassword,budget,transactions}));cov_1kd2f9lwom.s[20]++;id=user.id;cov_1kd2f9lwom.s[21]++;await user.save();});cov_1kd2f9lwom.s[22]++;it('should succeed on modify email using correct values',async()=>{cov_1kd2f9lwom.f[4]++;cov_1kd2f9lwom.s[23]++;newEmail=`email-${random()}@mail.com`;cov_1kd2f9lwom.s[24]++;newPassword=newVerifiedPassword=undefined;cov_1kd2f9lwom.s[25]++;await editUser(id,newEmail,newPassword,newVerifiedPassword);const user=(cov_1kd2f9lwom.s[26]++,await User.findById(id));cov_1kd2f9lwom.s[27]++;expect(user).to.exist;cov_1kd2f9lwom.s[28]++;expect(user.id).to.equal(id);cov_1kd2f9lwom.s[29]++;expect(user.username).to.equal(username);cov_1kd2f9lwom.s[30]++;expect(user.email).to.equal(newEmail);let match=(cov_1kd2f9lwom.s[31]++,await bcrypt.compare(password,user.password));cov_1kd2f9lwom.s[32]++;expect(match).to.be.true;});cov_1kd2f9lwom.s[33]++;it('should succeed on modify password using correct values',async()=>{cov_1kd2f9lwom.f[5]++;cov_1kd2f9lwom.s[34]++;newEmail=undefined;cov_1kd2f9lwom.s[35]++;newPassword=newVerifiedPassword=`password-${random()}`;cov_1kd2f9lwom.s[36]++;await editUser(id,newEmail,newPassword,newVerifiedPassword);const user=(cov_1kd2f9lwom.s[37]++,await User.findById(id));cov_1kd2f9lwom.s[38]++;expect(user).to.exist;cov_1kd2f9lwom.s[39]++;expect(user.id).to.equal(id);cov_1kd2f9lwom.s[40]++;expect(user.username).to.equal(username);cov_1kd2f9lwom.s[41]++;expect(user.email).to.equal(email);let match=(cov_1kd2f9lwom.s[42]++,await bcrypt.compare(newPassword,user.password));cov_1kd2f9lwom.s[43]++;expect(match).to.be.true;});cov_1kd2f9lwom.s[44]++;it('should failed on modify password without verified password',async()=>{cov_1kd2f9lwom.f[6]++;cov_1kd2f9lwom.s[45]++;newEmail=undefined;cov_1kd2f9lwom.s[46]++;newPassword=`password-${random()}`;cov_1kd2f9lwom.s[47]++;newVerifiedPassword=undefined;cov_1kd2f9lwom.s[48]++;try{cov_1kd2f9lwom.s[49]++;await editUser(id,newEmail,newPassword,newVerifiedPassword);cov_1kd2f9lwom.s[50]++;throw Error(`should not reach this point`);}catch(error){cov_1kd2f9lwom.s[51]++;expect(error).to.exist;cov_1kd2f9lwom.s[52]++;expect(error.message).to.exist;cov_1kd2f9lwom.s[53]++;expect(typeof error.message).to.equal('string');cov_1kd2f9lwom.s[54]++;expect(error).to.be.an.instanceOf(CredentialsError);cov_1kd2f9lwom.s[55]++;expect(error.message.length).to.be.greaterThan(0);cov_1kd2f9lwom.s[56]++;expect(error.message).to.equal(`failed to modify password, passwords are not the same, please introduce correctly your password and it's verification`);}});cov_1kd2f9lwom.s[57]++;it('should failed on modify password without verified password',async()=>{cov_1kd2f9lwom.f[7]++;cov_1kd2f9lwom.s[58]++;newEmail=undefined;cov_1kd2f9lwom.s[59]++;newPassword=undefined;cov_1kd2f9lwom.s[60]++;newVerifiedPassword=`password-${random()}`;cov_1kd2f9lwom.s[61]++;try{cov_1kd2f9lwom.s[62]++;await editUser(id,newEmail,newPassword,newVerifiedPassword);cov_1kd2f9lwom.s[63]++;throw Error(`should not reach this point`);}catch(error){cov_1kd2f9lwom.s[64]++;expect(error).to.exist;cov_1kd2f9lwom.s[65]++;expect(error.message).to.exist;cov_1kd2f9lwom.s[66]++;expect(typeof error.message).to.equal('string');cov_1kd2f9lwom.s[67]++;expect(error).to.be.an.instanceOf(CredentialsError);cov_1kd2f9lwom.s[68]++;expect(error.message.length).to.be.greaterThan(0);cov_1kd2f9lwom.s[69]++;expect(error.message).to.equal(`failed to modify password, passwords are not the same, please introduce correctly your password and it's verification`);}});cov_1kd2f9lwom.s[70]++;it('should fail on wrong user id',async()=>{cov_1kd2f9lwom.f[8]++;let wrongId=(cov_1kd2f9lwom.s[71]++,'012345678901234567890123');cov_1kd2f9lwom.s[72]++;try{cov_1kd2f9lwom.s[73]++;await editUser(wrongId);cov_1kd2f9lwom.s[74]++;throw Error('should not reach this point');}catch(error){cov_1kd2f9lwom.s[75]++;expect(error).to.exist;cov_1kd2f9lwom.s[76]++;expect(error).to.be.an.instanceOf(NotFoundError);cov_1kd2f9lwom.s[77]++;expect(error.message).to.equal(`user with id ${wrongId} not found`);}});cov_1kd2f9lwom.s[78]++;it('should fail on invalid data type of user id',async()=>{cov_1kd2f9lwom.f[9]++;let invalidId=(cov_1kd2f9lwom.s[79]++,'sadasdasdasdasdasdas');cov_1kd2f9lwom.s[80]++;try{cov_1kd2f9lwom.s[81]++;await editUser(invalidId);cov_1kd2f9lwom.s[82]++;throw Error('should not reach this point');}catch(error){cov_1kd2f9lwom.s[83]++;expect(error).to.exist;cov_1kd2f9lwom.s[84]++;expect(error).to.be.an.instanceOf(ContentError);cov_1kd2f9lwom.s[85]++;expect(error.message).to.equal(`${invalidId} is not a valid id`);}});});cov_1kd2f9lwom.s[86]++;after(()=>{cov_1kd2f9lwom.f[10]++;cov_1kd2f9lwom.s[87]++;return User.deleteMany().then(database.disconnect);});});